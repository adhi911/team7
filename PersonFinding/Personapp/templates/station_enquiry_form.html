<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    def station_enquiry(request, station_id):
    # Get the station details
    station = get_object_or_404(Station, id=station_id)

    if request.method == 'POST':
        form = StationEnquiryForm(request.POST)
        if form.is_valid():
            enquiry = form.save(commit=False)
            enquiry.station = station  # Link enquiry to station
            
            # Fix: Assign the logged-in user correctly
            if 'user_id' in request.session:
                enquiry.user = get_object_or_404(Login, id=request.session['user_id'])
            else:
                enquiry.user = None  # Anonymous enquiry

            enquiry.save()
            messages.success(request, "Your enquiry has been submitted successfully!")
            return redirect('stationsearch')  # Redirect after success
    else:
        form = StationEnquiryForm()

    return render(request, 'station_enquiry_form.html', {'form': form, 'station': station})

</body>
</html>